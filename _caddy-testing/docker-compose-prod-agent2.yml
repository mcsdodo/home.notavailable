services:
  caddy-agent:
    image: caddy-agent:latest
    container_name: caddy-agent-remote
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - AGENT_MODE=agent
      - AGENT_ID=host2-remote
      - CADDY_SERVER_URL=http://192.168.0.96:2019
      - HOST_IP=192.168.0.98
      - DOCKER_LABEL_PREFIX=caddy
    network_mode: host

  # Test service - remote container on host2
  test-remote:
    image: hashicorp/http-echo
    container_name: test-remote
    restart: unless-stopped
    network_mode: host
    command:
      - -listen=:8080
      - -text=Hello from host2
    labels:
      caddy: test-remote.lan
      caddy.reverse_proxy: "{{upstreams 5678}}"
