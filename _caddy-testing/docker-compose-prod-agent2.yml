services:
  caddy-agent:
    image: caddy-agent:phase3
    container_name: caddy-agent-remote
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - AGENT_MODE=agent
      - AGENT_ID=host2-remote
      - CADDY_SERVER_URL=http://192.168.0.96:2019
      - HOST_IP=192.168.0.98
      - DOCKER_LABEL_PREFIX=caddy
    network_mode: host

  # Test service - simple label (backward compatibility)
  test-remote:
    image: hashicorp/http-echo
    container_name: test-remote
    restart: unless-stopped
    network_mode: host
    command:
      - -listen=:5678
      - -text=Simple label on host2
    labels:
      caddy: test-remote.lan
      caddy.reverse_proxy: "{{upstreams 5678}}"

  # Phase 1 test - multiple domains (main feature for host2)
  test-multi-host2:
    image: hashicorp/http-echo
    container_name: test-multi-host2
    restart: unless-stopped
    network_mode: host
    command:
      - -listen=:5679
      - -text=Multi-domain on host2
    labels:
      caddy: host2-app1.lan, host2-app2.lan
      caddy.reverse_proxy: "{{upstreams 5679}}"

  # Phase 1 test - high numbered labels
  test-high-numbers:
    image: hashicorp/http-echo
    container_name: test-high-numbers
    restart: unless-stopped
    network_mode: host
    command:
      - -listen=:5680
      - -text=High numbered routes
    labels:
      caddy_10: host2-route10.lan
      caddy_10.reverse_proxy: "{{upstreams 5680}}"
      caddy_111: host2-route111.lan
      caddy_111.reverse_proxy: "{{upstreams 5680}}"

  # Phase 2 test - snippet import
  test-snippet-import:
    image: hashicorp/http-echo
    container_name: test-snippet-import
    restart: unless-stopped
    network_mode: host
    command:
      - -listen=:5681
      - -text=Phase 2 - Snippet import on host2
    labels:
      caddy_20: phase2-import.lan
      caddy_20.import: test_snippet
      caddy_20.reverse_proxy: "{{upstreams 5681}}"

  # Phase 3 test - header manipulation (header_up)
  test-header-manipulation:
    image: hashicorp/http-echo
    container_name: test-header-manipulation
    restart: unless-stopped
    network_mode: host
    command:
      - -listen=:5682
      - -text=Phase 3 - Header manipulation on host2
    labels:
      caddy_30: phase3-headers.lan
      caddy_30.reverse_proxy: "{{upstreams 5682}}"
      caddy_30.reverse_proxy.header_up: "-X-Forwarded-For"
      caddy_30.reverse_proxy.header_down: "-Server"
